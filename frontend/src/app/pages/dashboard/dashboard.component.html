<div class="page">
  <h1>Upcoming Vacations</h1>

  <div *ngIf="loading" class="loading">Loading data...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <mat-card class="table-card" *ngIf="!loading && !error">
    <table mat-table [dataSource]="getDisplayedVacations()" class="mat-elevation-z1">
      <ng-container matColumnDef="start">
        <th mat-header-cell *matHeaderCellDef>Starts</th>
        <td mat-cell *matCellDef="let v">{{ formatDate(v.startDate) }}</td>
      </ng-container>

      <ng-container matColumnDef="end">
        <th mat-header-cell *matHeaderCellDef class="center-header">Ends</th>
        <td mat-cell *matCellDef="let v" class="center-cell">{{ formatDate(v.endDate) }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="status-header">Status</th>
        <td mat-cell *matCellDef="let v" class="status-cell">
          <mat-chip-set class="status-chips" *ngIf="getStatusView(v.status) as statusView">
            <mat-chip [ngClass]="statusView.class">{{ statusView.label }}</mat-chip>
          </mat-chip-set>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
        <td mat-cell *matCellDef="let v" class="actions-cell">
          <button mat-button color="warn"
            *ngIf="v.status === 0 || v.status === 'Pending' || getStatusView(v.status).class === 'pending'"
            (click)="cancelVacation(v)" [disabled]="cancelingId === v.id" title="Cancel this vacation request">
            {{ cancelingId === v.id ? 'Canceling...' : 'Cancel' }}
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <div *ngIf="vacations.length > vacationsLimit && !showAllVacations" class="see-all-button">
      <button mat-stroked-button (click)="toggleAllVacations()">See all vacations</button>
    </div>
    <div *ngIf="showAllVacations && vacations.length > vacationsLimit" class="see-all-button">
      <button mat-stroked-button (click)="toggleAllVacations()">Show less</button>
    </div>
    <div *ngIf="cancelError" class="error-message">{{ cancelError }}</div>
  </mat-card>

  <div class="grid">
    <mat-card class="contact-card">
      <h2>Contact</h2>
      <div *ngIf="employer" class="employer-contact">
        <div class="employer-name clickable" (click)="openEmployerEmail()" (keyup.enter)="openEmployerEmail()"
          title="Send email" tabindex="0" role="button">
          {{ employer.firstName }} {{ employer.lastName }}
        </div>
        <div class="muted role">{{ (employer.role ?? 0) === 1 ? 'Employer' : 'Employee' }}</div>
      </div>
      <div *ngIf="!employer" class="no-contact">
        <mat-icon>contact_mail</mat-icon>
        <span>No employer found</span>
      </div>
    </mat-card>

    <mat-card class="announcements-card">
      <h2>Latest Announcements</h2>
      <div *ngIf="notices.length > 0" class="notices-list">
        <div *ngFor="let notice of notices" class="notice-item clickable" (click)="onNoticeClick(notice, $event)"
          (keyup.enter)="onNoticeClick(notice, $event)" tabindex="0" role="button">
          <div class="notice-header">
            <div class="notice-title-wrapper">
              <div class="unread-dot" *ngIf="isNoticeUnread(notice.id)"></div>
              <h3 class="notice-title">{{ notice.title }}</h3>
            </div>
            <span class="notice-date">{{ notice.createdAt | date:'dd.MM.yyyy' }}</span>
          </div>
          <div class="notice-author">{{ getAuthorName(notice) }}</div>
          <p class="notice-content">{{ truncateContent(notice.content, 120) }}</p>
        </div>
      </div>
      <div *ngIf="notices.length === 0" class="no-notices">
        <mat-icon>info</mat-icon>
        <span>No announcements</span>
      </div>
      <div *ngIf="allNotices.length > noticesLimit && !showAllNotices" class="see-all-button">
        <button mat-stroked-button (click)="toggleAllNotices()">See all announcements</button>
      </div>
      <div *ngIf="showAllNotices && allNotices.length > noticesLimit" class="see-all-button">
        <button mat-stroked-button (click)="toggleAllNotices()">Show less</button>
      </div>
    </mat-card>

    <mat-card class="docs" *ngIf="latestDocument; else noDocs">
      <h2>Latest Document</h2>
      <div class="doc-title">{{ latestDocument.title }}</div>
      <p class="doc-desc">{{ latestDocument.description || 'No description' }}</p>
      <mat-icon class="doc-icon clickable" fontIcon="description" (click)="downloadDocument(latestDocument)"
        (keyup.enter)="downloadDocument(latestDocument)" tabindex="0" role="button" title="Download document">
      </mat-icon>
      <div class="doc-date">Uploaded: {{ latestDocument.createdAt | date:'dd.MM.yyyy' }}</div>
    </mat-card>

    <ng-template #noDocs>
      <mat-card class="docs">
        <h2>Documents</h2>
        <div class="muted">No documents</div>
        <p>No documents uploaded yet.</p>
        <mat-icon class="doc-icon" fontIcon="folder_off"></mat-icon>
      </mat-card>
    </ng-template>
  </div>
</div>