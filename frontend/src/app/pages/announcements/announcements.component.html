<div class="page announcements-page">

  <!-- Modal overlay s celou spravou uprostred obrazovky -->
  <div class="detail-overlay" *ngIf="selected as s">
    <div class="detail-backdrop" (click)="close()" (keyup.enter)="close()" tabindex="0" role="button"></div>
    <div class="detail-modal">
      <div class="detail-header">
        <div class="detail-title">{{ s.title }}</div>
      </div>
      <div class="detail-meta">
        <mat-icon class="detail-meta-icon">person</mat-icon>
        <span class="detail-meta-author">{{ s.author }}</span>
        <span class="detail-meta-separator">â€¢</span>
        <span class="detail-meta-date">{{ s.createdAt | date:'MMMM d, y, h:mm a' }}</span>
      </div>
      <div class="detail-body">{{ s.body }}</div>
      <div class="detail-actions">
        <button mat-raised-button color="primary" (click)="close()">Close</button>
      </div>
    </div>
  </div>

  <!-- Sprava o chybe -->
  <div *ngIf="error" class="error-message">
    {{ error }}
    <button mat-button (click)="loadNotices()">Try again</button>
  </div>

  <!-- Hlavicka s nadpisom a tlacidlom na vytvorenie -->
  <div class="header announcements-header">
    <h1>Announcements</h1>
    <button mat-raised-button color="primary" (click)="openCreateDialog()" *ngIf="canCreate">
      <mat-icon>add</mat-icon>
      Create Announcement
    </button>
  </div>

  <!-- Stav nacitavania -->
  <div *ngIf="loading" class="loading">
    Loading...
  </div>

  <!-- Obsah ked sa nenacitava -->
  <div *ngIf="!loading">
    <!-- Najnovsie oznamenie -->
    <h2 *ngIf="latest">Latest</h2>
    <mat-card *ngIf="latest" class="latest-card" (click)="select(latest)" (keyup.enter)="select(latest)" tabindex="0"
      role="button">
      <div class="latest-header">
        <div class="latest-header-content">
          <div class="status-dot" *ngIf="isNoticeUnread(latest.id)"></div>
          <div class="latest-title">{{ latest.title }}</div>
        </div>
        <button mat-icon-button color="warn" *ngIf="canCreate" (click)="deleteNotice($event, latest.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      <div class="latest-meta">
        <small>{{ latest.author }} | {{ latest.createdAt | date:'dd.MM.yyyy HH:mm' }}</small>
      </div>
      <div class="latest-body">
        {{ latest.preview }}
      </div>
    </mat-card>

    <!-- Vsetky oznamenia -->
    <h2 *ngIf="all.length > 0">All Announcements</h2>
    <mat-card class="all-card" *ngIf="all.length > 0">
      <div class="row" *ngFor="let a of all" (click)="select(a)" (keyup.enter)="select(a)" tabindex="0" role="button">
        <div class="row-header">
          <div class="name">{{ a.title }}</div>
          <div class="row-actions">
            <div class="date">{{ a.createdAt | date:'dd.MM.yyyy' }}</div>
            <button mat-icon-button color="warn" class="delete-button" *ngIf="canCreate"
              (click)="deleteNotice($event, a.id)">
              <mat-icon class="delete-icon">delete</mat-icon>
            </button>
          </div>
        </div>
        <div class="author">{{ a.author }}</div>
        <div class="preview">{{ a.preview }}</div>
      </div>
    </mat-card>

    <!-- Prazdny stav -->
    <div *ngIf="all.length === 0" class="empty-state">
      <mat-icon>info</mat-icon>
      <p>No announcements yet.</p>
      <button mat-stroked-button color="primary" (click)="openCreateDialog()" *ngIf="canCreate">
        Create First Announcement
      </button>
    </div>
  </div>
</div>